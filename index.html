<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-lang="page-title">Retouch - Mükemmellik. Ortaya Çıktı.</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Raleway:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold-color: #FFD700;
            --dark-bg: #1A1A1A;
            --text-light: #F0F0F0;
            --font-serif: 'Playfair Display', serif;
            --font-sans: 'Raleway', sans-serif;
        }
        html { scroll-behavior: smooth; }
        body { margin: 0; font-family: var(--font-sans); color: var(--text-light); background-color: var(--dark-bg); overflow-y: auto; }
        a { color: var(--gold-color); text-decoration: none; transition: color 0.3s ease; }
        a:hover { color: #FFF; }
        #bg-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }
        .main-header { position: fixed; top: 0; left: 0; width: 100%; display: flex; justify-content: space-between; align-items: center; padding: 20px 40px; z-index: 100; background: linear-gradient(to bottom, rgba(0,0,0,0.6), rgba(0,0,0,0)); box-sizing: border-box; }
        .logo { display: flex; align-items: center; color: var(--gold-color); }
        .logo svg { margin-right: 10px; stroke: var(--gold-color); }
        .brand-name { font-family: var(--font-serif); font-size: 1.5em; font-weight: bold; }
        .main-nav { display: flex; align-items: center; flex-wrap: wrap; }
        .main-nav .nav-link { margin-left: 30px; font-size: 1.1em; position: relative; padding-bottom: 5px; }
        .main-nav .nav-link::after { content: ''; position: absolute; left: 0; bottom: 0; width: 0; height: 2px; background-color: var(--gold-color); transition: width 0.3s ease; }
        .main-nav .nav-link:hover::after { width: 100%; }
        .user-controls { display: flex; align-items: center; gap: 15px; margin-left: 30px; }
        .lang-selector { display: flex; align-items: center; gap: 5px; border-left: 1px solid rgba(255, 255, 255, 0.2); padding-left: 15px; }
        .lang-option { color: var(--text-light); font-weight: 500; padding: 5px 8px; border-radius: 4px; transition: all 0.3s ease; font-size: 0.9em; }
        .lang-option.active { color: var(--dark-bg); background-color: var(--gold-color); }
        .lang-option:not(.active):hover { color: var(--gold-color); }
        .credit-display { display: flex; align-items: center; gap: 8px; color: var(--gold-color); font-weight: 500; background-color: rgba(0,0,0,0.3); padding: 5px 15px; border-radius: 20px; border: 1px solid rgba(255, 215, 0, 0.3); white-space: nowrap; }
        #user-info { align-items: center; gap: 15px; }
        #user-email { font-size: 0.9em; opacity: 0.8; }
        .hero-section { display: flex; justify-content: center; align-items: center; min-height: 100vh; text-align: center; padding: 0 20px; position: relative; z-index: 1; box-sizing: border-box; }
        .hero-content { max-width: 800px; transform: translateY(-20px); }
        .main-logo-center svg { stroke: var(--gold-color); fill: none; margin-bottom: 20px; }
        .hero-content h1 { font-family: var(--font-serif); font-size: 4.5em; color: var(--gold-color); margin-bottom: 10px; line-height: 1.1; text-shadow: 0 0 15px rgba(255, 215, 0, 0.4); transition: opacity 0.5s ease-in-out; }
        .hero-content p { font-family: var(--font-sans); font-size: 1.4em; color: var(--text-light); margin-bottom: 40px; letter-spacing: 0.5px; transition: opacity 0.5s ease-in-out; }
        .btn-primary, .btn-secondary, .btn-tertiary { display: inline-block; padding: 12px 30px; font-size: 1em; font-weight: 500; border-radius: 50px; transition: all 0.3s ease; cursor: pointer; border: none; text-align: center; }
        .btn-primary { background: linear-gradient(to right, #DAA520, var(--gold-color)); color: #111; box-shadow: 0 8px 25px rgba(255, 215, 0, 0.3); }
        .btn-primary:hover { transform: translateY(-3px); box-shadow: 0 12px 35px rgba(255, 215, 0, 0.5); }
        .btn-secondary { padding: 10px 20px; background: #333; color: var(--gold-color); border: 1px solid var(--gold-color); white-space: nowrap; }
        .btn-secondary:hover { background: var(--gold-color); color: #111; }
        .btn-tertiary { background: none; border: 1px solid #555; color: #aaa; padding: 10px 25px; margin-top: 10px; }
        .btn-tertiary:hover { background-color: #222; border-color: #777; color: #fff; }
        .auth-switch-container { text-align: center; margin-top: 25px; }
        .auth-switch-container p { margin-bottom: 10px; }
        .content-section { padding: 100px 40px; position: relative; z-index: 1; background-color: rgba(10, 10, 10, 0.5); backdrop-filter: blur(5px); }
        .section-content { max-width: 1100px; margin: 0 auto; text-align: center; }
        .section-content h2 { font-family: var(--font-serif); font-size: 3em; color: var(--gold-color); margin-bottom: 20px; text-shadow: 0 0 10px rgba(255, 215, 0, 0.3); }
        .section-content p { font-size: 1.2em; line-height: 1.7; }
        .editor-container { position: fixed; top: 0; left: 0; width: 100%; height: 100vh; background-color: var(--dark-bg); z-index: 200; display: flex; flex-direction: column; }
        #editor-toolbar { display: flex; align-items: center; justify-content: center; gap: 15px; padding: 15px; background-color: #111; flex-shrink: 0; flex-wrap: wrap; }
        .tool { display: flex; align-items: center; gap: 10px; }
        #canvas-container { flex-grow: 1; display: flex; justify-content: center; align-items: center; padding: 20px; overflow: hidden; position: relative; }
        #editor-canvas { max-width: 100%; max-height: 100%; object-fit: contain; cursor: crosshair; border-radius: 8px; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        #loading-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.8); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 1000; color: var(--gold-color); font-size: 1.5em; }
        .spinner { border: 8px solid rgba(255, 215, 0, 0.2); border-top: 8px solid var(--gold-color); border-radius: 50%; width: 60px; height: 60px; animation: spin 1.2s linear infinite; margin-bottom: 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .main-footer { text-align: center; padding: 25px 0; font-size: 0.9em; color: rgba(255, 255, 255, 0.6); position: relative; z-index: 1; background-color: #111; border-top: 1px solid rgba(255, 215, 0, 0.2); }
        #cookie-consent-banner { position: fixed; bottom: 0; left: 0; width: 100%; background-color: rgba(10, 10, 10, 0.9); backdrop-filter: blur(5px); padding: 20px; z-index: 1001; display: none; flex-wrap: wrap; align-items: center; justify-content: center; text-align: center; gap: 20px; border-top: 1px solid var(--gold-color); box-sizing: border-box; }
        #cookie-consent-banner p { margin: 0; flex-grow: 1; max-width: 800px; }
        #cookie-consent-banner a { text-decoration: underline; }
        .pricing-tiers { display: flex; gap: 30px; justify-content: center; flex-wrap: wrap; }
        .tier { background-color: #1A1A1A; padding: 30px; border-radius: 10px; flex: 1; min-width: 250px; max-width: 280px; border: 1px solid #444; transition: all 0.3s ease; position: relative; overflow: hidden; }
        .tier:hover { transform: translateY(-10px); border-color: var(--gold-color); }
        .tier.popular { border-color: var(--gold-color); transform: scale(1.05); }
        .popular-badge { position: absolute; top: 15px; right: -30px; background-color: var(--gold-color); color: var(--dark-bg); padding: 5px 30px; transform: rotate(45deg); font-size: 0.9em; font-weight: bold; }
        .tier h3 { font-family: var(--font-serif); font-size: 1.8em; margin-top: 0; }
        .tier .price { font-size: 3em; font-weight: bold; color: var(--gold-color); margin: 20px 0; }
        .tier .price.free { font-size: 2.2em; }
        .tier ul { list-style: none; padding: 0; margin: 20px 0 30px 0; text-align: left; }
        .tier ul li { margin-bottom: 15px; padding-left: 25px; position: relative; }
        .tier ul li::before { content: '✓'; color: var(--gold-color); position: absolute; left: 0; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.8); backdrop-filter: blur(8px); z-index: 1100; justify-content: center; align-items: center; display: none; opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease; }
        .modal-overlay.show { display: flex; opacity: 1; visibility: visible; }
        .modal-content { background-color: #222; padding: 40px; border-radius: 15px; border: 1px solid var(--gold-color); text-align: center; position: relative; max-width: 900px; width: 90%; box-shadow: 0 10px 40px rgba(255, 215, 0, 0.2); transform: scale(0.95); transition: transform 0.3s ease; }
        .modal-overlay.show .modal-content { transform: scale(1); }
        .close-modal-btn { position: absolute; top: 15px; right: 20px; background: none; border: none; color: var(--text-light); font-size: 2.5em; cursor: pointer; line-height: 1; }
        .modal-content h2 { font-size: 2.8em; margin-top: 0; }
        .modal-content p { font-size: 1.2em; color: rgba(255, 255, 255, 0.8); margin-bottom: 30px; }
        .form-group { margin-bottom: 20px; text-align: left; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 500; }
        .form-group input { width: 100%; padding: 12px 15px; font-size: 1em; border-radius: 8px; border: 1px solid #555; background-color: #333; color: var(--text-light); box-sizing: border-box; transition: all 0.2s ease; }
        .form-group input:focus { border-color: var(--gold-color); outline: none; box-shadow: 0 0 10px rgba(255, 215, 0, 0.3); }
        #auth-modal .modal-content, #payment-modal .modal-content, #prompt-modal .modal-content { max-width: 450px; }
        .auth-form-container .form-group { margin-bottom: 20px; }
        .auth-form-container { display: none; }
        .auth-form-container.active { display: block; }
        #prompt-input { width: 100%; box-sizing: border-box; }
        .form-row { display: flex; gap: 20px; }
        .form-row .form-group { flex: 1; }
        #payment-form .btn-primary { width: 100%; margin-top: 10px; }
        #auth-error { color: #ff6b6b; margin-top: 15px; font-size: 0.9em; height: 1.2em; }
        #pricing .tier { opacity: 0; transform: translateY(40px); transition: opacity 0.6s ease-out, transform 0.6s ease-out; }
        #pricing .tier.is-visible { opacity: 1; transform: translateY(0); }
        #pricing .tier:nth-child(2).is-visible { transition-delay: 0.2s; }
        #pricing .tier:nth-child(3).is-visible { transition-delay: 0.4s; }
        @media (max-width: 768px) {
            body { font-size: 15px; }
            .content-section { padding: 80px 20px; }
            .main-header { flex-direction: column; padding: 15px; gap: 15px; }
            .main-nav { margin-top: 0; justify-content: center; width: 100%; flex-wrap: wrap; gap: 10px 20px; }
            .main-nav .nav-link { margin: 0; }
            .user-controls { width: 100%; margin-left: 0; flex-wrap: wrap; justify-content: center; gap: 15px; }
            .hero-content h1 { font-size: 3em; }
            .hero-content p { font-size: 1.1em; }
            #hero-section .btn-primary { padding: 15px 35px; font-size: 1em; }
            .section-content h2 { font-size: 2.5em; }
            .pricing-tiers { flex-direction: column; align-items: center; gap: 25px; }
            .tier.popular { transform: scale(1); }
            #editor-toolbar { padding: 15px; gap: 10px; }
            #editor-toolbar .btn-secondary { padding: 10px 18px; font-size: 0.9em; }
            .modal-content { padding: 25px; width: 95%; max-height: 90vh; overflow-y: auto; }
            .modal-content h2 { font-size: 1.8em; }
            #cookie-consent-banner { flex-direction: column; padding: 15px; text-align: center; }
            #cookie-consent-banner p { margin-bottom: 15px; }
        }
        @media (max-width: 480px) {
            .main-header { padding: 15px 10px; }
            .main-nav { gap: 10px; }
            .user-controls { gap: 10px; }
            .hero-content h1 { font-size: 2.4em; }
            .hero-content p { font-size: 1em; }
            .section-content h2 { font-size: 2em; }
            #editor-toolbar { flex-direction: column; padding: 15px; }
            #editor-toolbar .tool { width: 100%; flex-direction: row; justify-content: center; }
            #editor-toolbar .tool input[type="range"]{ width: 60%; }
            #editor-toolbar .btn-secondary { width: 80%; box-sizing: border-box; }
        }
    </style>
</head>
<body>
    <!-- Firebase SDK'ları -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";
        window.firebase = {
            initializeApp, getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged,
            getFirestore, doc, getDoc, setDoc, updateDoc, increment
        };
    </script>

    <canvas id="bg-canvas"></canvas>
    
    <div id="main-content">
        <header class="main-header">
            <div class="logo">
                <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>
                <span class="brand-name" data-lang="brand-name">Retouch</span>
            </div>
            <nav class="main-nav">
                <a href="#about" class="nav-link" data-lang="nav-about">Hakkında</a>
                <a href="#pricing" class="nav-link" data-lang="nav-pricing">Fiyatlandırma</a>
                <a href="#contact" class="nav-link" data-lang="nav-contact">İletişim</a>
                <div class="user-controls">
                    <div id="logged-out-view">
                        <button id="login-nav-btn" class="btn-secondary" data-lang="login-btn">Giriş Yap</button>
                    </div>
                    <div id="logged-in-view" style="display: none; align-items: center; gap: 15px;">
                        <div class="credit-display">
                            <span data-lang="credit-label">Kredi:</span>
                            <span id="credit-count">0</span>
                        </div>
                        <span id="user-email"></span>
                        <button id="logout-btn" class="btn-secondary" data-lang="logout-btn">Çıkış Yap</button>
                    </div>
                    <div class="lang-selector">
                        <a href="#" class="lang-option" data-lang-switch="tr">TR</a>
                        <a href="#" class="lang-option" data-lang-switch="en">EN</a>
                    </div>
                </div>
            </nav>
        </header>

        <main class="hero-section" id="hero-section">
            <div class="hero-content">
                <div class="main-logo-center">
                    <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>
                </div>
                <h1 id="hero-title"></h1>
                <p id="hero-subtitle"></p>
                <a id="upload-btn" class="btn-primary" data-lang="btn-start">Dönüşüme Başla</a>
                <input type="file" id="file-input" hidden accept="image/*">
            </div>
        </main>

        <section id="about" class="content-section">
            <div class="section-content">
                <h2 data-lang="about-title">Hakkımızda</h2>
                <p data-lang="about-p">Retouch, fotoğraflarınızdaki istenmeyen nesneleri kusursuzca ortadan kaldırmak için en son yapay zeka teknolojisini kullanır. Misyonumuz, anılarınızı en saf haliyle korumanıza yardımcı olmaktır. Sadece birkaç tıklama ile dikkat dağıtıcı unsurları kaldırın ve mükemmel fotoğrafı ortaya çıkarın.</p>
            </div>
        </section>

        <section id="pricing" class="content-section">
            <div class="section-content">
                <h2 data-lang="pricing-title">Size Uygun Planı Seçin</h2>
                <p data-lang="pricing-subtitle" style="margin-bottom: 50px;">Hemen başlayın ve yaratıcılığınızın sınırlarını kaldırın.</p>
                <div class="pricing-tiers">
                    <div class="tier">
                        <h3 data-lang="tier1-title">Ücretsiz</h3>
                        <p class="price free" data-lang="tier1-price">Ücretsiz</p>
                        <ul>
                            <li data-lang="tier1-li1">5 Kredi</li>
                        </ul>
                        <button class="btn-primary" data-lang="btn-free-start">Ücretsiz Başla</button>
                    </div>
                    <div class="tier popular">
                        <span class="popular-badge" data-lang="popular-badge">Popüler</span>
                        <h3 data-lang="tier2-title">Profesyonel</h3>
                        <p class="price" data-lang="tier2-price">$9.99</p>
                        <ul>
                            <li data-lang="tier2-li1">50 Kredi</li>
                            <li data-lang="tier2-li2">HD İndirmeler</li>
                        </ul>
                        <button class="btn-primary btn-purchase" data-plan="professional" data-lang="btn-purchase">Satın Al</button>
                    </div>
                    <div class="tier">
                        <h3 data-lang="tier3-title">Stüdyo</h3>
                        <p class="price" data-lang="tier3-price">$14.99</p>
                        <ul>
                            <li data-lang="tier3-li1">100 Kredi</li>
                            <li data-lang="tier3-li2">7/24 Özel Destek</li>
                            <li data-lang="tier3-li3">4K İndirmeler</li>
                        </ul>
                        <button class="btn-primary btn-purchase" data-plan="studio" data-lang="btn-purchase">Satın Al</button>
                    </div>
                </div>
            </div>
        </section>

        <section id="contact" class="content-section">
            <div class="section-content">
                <h2 data-lang="contact-title">İletişim</h2>
                <p data-lang="contact-p">Bize ulaşmak için contact@retouch.com adresine e-posta gönderebilirsiniz. Sorularınızı ve geri bildirimlerinizi bekliyoruz.</p>
            </div>
        </section>

        <footer class="main-footer">
            <p><span data-lang="footer-text">&copy; 2024 Retouch |</span> <a href="#" data-lang="footer-terms">Şartlar</a> | <a href="privacy.html" target="_blank" data-lang="footer-privacy">Gizlilik</a></p>
        </footer>
    </div>

    <section id="editor-screen" class="editor-container" style="display: none;">
        <div id="editor-toolbar">
            <div class="tool">
                <label for="brush-size" data-lang="tool-brush">Fırça Boyutu:</label>
                <input type="range" id="brush-size" min="5" max="100" value="30" step="1">
            </div>
            <button id="erase-btn" class="btn-secondary" data-lang="btn-erase">Sil (2 Kredi)</button>
            <button id="transform-btn" class="btn-secondary" data-lang="btn-transform">Dönüştür (3 Kredi)</button>
            <button id="undo-btn" class="btn-secondary" data-lang="btn-undo" style="display: none;">Geri Al</button>
            <button id="download-btn" class="btn-secondary" style="display: none;" data-lang="btn-download">İndir</button>
            <button id="back-btn" class="btn-secondary" data-lang="btn-back">Geri</button>
        </div>
        <div id="canvas-container">
            <div id="loading-overlay" style="display: none;">
                <div class="spinner"></div>
                <p data-lang="loading-text">İşleniyor...</p>
            </div>
            <canvas id="editor-canvas"></canvas>
        </div>
    </section>

    <div id="cookie-consent-banner">
        <p data-lang="cookie-p">Sitemiz, kullanıcı deneyimini iyileştirmek için çerezleri kullanır. Bu siteyi kullanarak çerez kullanımımızı kabul etmiş olursunuz. Daha fazla bilgi için <a href="privacy.html" target="_blank" data-lang="cookie-link">Gizlilik Politikamızı</a> inceleyin.</p>
        <button id="accept-cookies-btn" class="btn-secondary" data-lang="cookie-btn">Kabul Et</button>
    </div>

    <div id="pricing-modal" class="modal-overlay">
        <div class="modal-content">
            <button class="close-modal-btn">&times;</button>
            <h2 data-lang="modal-title">Krediniz Bitti!</h2>
            <p data-lang="modal-subtitle">Düzenlemeye devam etmek için bir paket seçin.</p>
            <div class="pricing-tiers">
                 <div class="tier">
                    <h3 data-lang="tier1-title">Ücretsiz</h3>
                    <p class="price free" data-lang="tier1-price">Ücretsiz</p>
                    <ul>
                        <li data-lang="tier1-li1">5 Kredi</li>
                    </ul>
                    <button class="btn-primary" data-lang="btn-free-start">Ücretsiz Başla</button>
                </div>
                <div class="tier popular">
                    <span class="popular-badge" data-lang="popular-badge">Popüler</span>
                    <h3 data-lang="tier2-title">Profesyonel</h3>
                    <p class="price" data-lang="tier2-price">$9.99</p>
                    <ul>
                        <li data-lang="tier2-li1">50 Kredi</li>
                        <li data-lang="tier2-li2">HD İndirmeler</li>
                    </ul>
                    <button class="btn-primary btn-purchase" data-plan="professional" data-lang="btn-purchase">Satın Al</button>
                </div>
                <div class="tier">
                    <h3 data-lang="tier3-title">Stüdyo</h3>
                    <p class="price" data-lang="tier3-price">$14.99</p>
                    <ul>
                        <li data-lang="tier3-li1">100 Kredi</li>
                        <li data-lang="tier3-li2">7/24 Özel Destek</li>
                        <li data-lang="tier3-li3">4K İndirmeler</li>
                    </ul>
                    <button class="btn-primary btn-purchase" data-plan="studio" data-lang="btn-purchase">Satın Al</button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="prompt-modal" class="modal-overlay">
        <div class="modal-content">
            <button class="close-modal-btn">&times;</button>
            <h2 data-lang="prompt-modal-title">Sihirbaz</h2>
            <p data-lang="prompt-modal-subtitle">İşaretlediğiniz alanı neye dönüştürmek istersiniz?</p>
            <input type="text" id="prompt-input" data-lang-placeholder="prompt-placeholder" placeholder="Örn: kırmızı bir spor araba">
            <button id="submit-prompt-btn" class="btn-primary" data-lang="prompt-submit-btn">Dönüştür</button>
        </div>
    </div>

    <div id="payment-modal" class="modal-overlay">
        <div class="modal-content">
            <button class="close-modal-btn">&times;</button>
            <h2 data-lang="payment-title">Güvenli Ödeme</h2>
            <p id="payment-summary" style="color: rgba(255, 255, 255, 0.8);"></p>
            <form id="payment-form">
                <div class="form-group">
                    <label for="card-number" data-lang="card-number-label">Kart Numarası</label>
                    <input type="text" id="card-number" placeholder="•••• •••• •••• ••••" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="expiry-date" data-lang="expiry-date-label">Son K. Tarihi</label>
                        <input type="text" id="expiry-date" placeholder="AA/YY" required>
                    </div>
                    <div class="form-group">
                        <label for="cvc" data-lang="cvc-label">CVC</label>
                        <input type="text" id="cvc" placeholder="•••" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="card-name" data-lang="card-name-label">Kart Üzerindeki İsim</label>
                    <input type="text" id="card-name" placeholder="Ad Soyad" required>
                </div>
                <button type="submit" class="btn-primary" data-lang="btn-pay">Ödeme Yap</button>
            </form>
        </div>
    </div>
    
    <div id="auth-modal" class="modal-overlay">
        <div class="modal-content">
            <button class="close-modal-btn">&times;</button>
            <!-- Login Form -->
            <div id="login-container" class="auth-form-container active">
                <h2 data-lang="login-title">Giriş Yap</h2>
                <form id="login-form">
                    <div class="form-group">
                        <label for="login-email" data-lang="email-label">E-posta</label>
                        <input type="email" id="login-email" required>
                    </div>
                    <div class="form-group">
                        <label for="login-password" data-lang="password-label">Şifre</label>
                        <input type="password" id="login-password" required minlength="6">
                    </div>
                    <button type="submit" class="btn-primary" data-lang="login-btn-form">Giriş Yap</button>
                </form>
                <div class="auth-switch-container">
                    <p data-lang="no-account-text">Hesabın yok mu?</p>
                    <button id="show-register-btn" class="btn-tertiary" data-lang="register-link">Kayıt Ol</button>
                </div>
            </div>
            <!-- Register Form -->
            <div id="register-container" class="auth-form-container">
                <h2 data-lang="register-title">Kayıt Ol</h2>
                <form id="register-form">
                    <div class="form-group">
                        <label for="register-email" data-lang="email-label">E-posta</label>
                        <input type="email" id="register-email" required>
                    </div>
                    <div class="form-group">
                        <label for="register-password" data-lang="password-label">Şifre</label>
                        <input type="password" id="register-password" required minlength="6">
                    </div>
                    <button type="submit" class="btn-primary" data-lang="register-btn-form">Kayıt Ol</button>
                </form>
                <div class="auth-switch-container">
                    <p data-lang="have-account-text">Zaten hesabın var mı?</p>
                    <button id="show-login-btn" class="btn-tertiary" data-lang="login-link">Giriş Yap</button>
                </div>
            </div>
             <p id="auth-error"></p>
        </div>
    </div>

    <script type="module">
        const { initializeApp, getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, getFirestore, doc, getDoc, setDoc, updateDoc, increment } = window.firebase;

        // --- FIREBASE KURULUMU ---
        const firebaseConfig = {
            apiKey: "AIzaSyAdIW6uDm9h23tiA9L611EsMF9TfkVA6lg",
            authDomain: "retouch-f383d.firebaseapp.com",
            projectId: "retouch-f383d",
            storageBucket: "retouch-f383d.appspot.com",
            messagingSenderId: "109135371283",
            appId: "1:109135371283:web:7a39863cc1f36aa81b33e6",
            measurementId: "G-N2RDJVPE5J"
        };
        
        // --- YÖNETİCİ HESAPLARI ---
        const adminEmails = ["birkan.ff@gmail.com", "smhisk2456@gmail.com"];

        // Firebase'i başlat
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // --- DİL VE ÇEVİRİ ---
        const translations = {
            'en': {
                'page-title': 'Retouch - Perfection. Unveiled.', 'brand-name': 'Retouch', 'nav-about': 'About', 'nav-pricing': 'Pricing', 'nav-contact': 'Contact', 
                'btn-start': 'Begin Transformation', 'about-title': 'About Us', 'about-p': 'Retouch uses the latest artificial intelligence technology to flawlessly remove unwanted objects from your photos. Our mission is to help you preserve your memories in their purest form. Remove distractions with just a few clicks and unveil the perfect picture.', 'contact-title': 'Contact', 'contact-p': 'To reach us, you can send an email to contact@retouch.com. We welcome your questions and feedback.', 'pricing-title': 'Choose The Right Plan For You', 'pricing-subtitle': 'Start now and lift the limits of your creativity.', 'footer-text': '© 2024 Retouch |', 'footer-terms': 'Terms', 'footer-privacy': 'Privacy', 
                'tool-brush': 'Brush Size:', 'btn-erase': 'Erase (2 Credits)', 'btn-transform': 'Transform (3 Credits)', 'btn-undo': 'Undo', 'btn-download': 'Download', 'btn-back': 'Back', 'loading-text': 'Processing...', 
                'cookie-p': 'Our site uses cookies to improve the user experience. By using this site, you accept our use of cookies. For more information, review our ', 'cookie-link': 'Privacy Policy', 'cookie-btn': 'Accept',
                'credit-label': 'Credits:', 'modal-title': 'Out of Credits!', 'modal-subtitle': 'Choose a plan to continue editing.', 
                'tier1-title': 'Free', 'tier1-price': 'Free', 'tier1-li1': '5 Credits', 'btn-free-start': 'Start for Free',
                'popular-badge': 'Popular', 'tier2-title': 'Professional', 'tier2-price': '$9.99', 'tier2-li1': '50 Credits', 'tier2-li2': 'HD Downloads', 'btn-purchase': 'Purchase',
                'tier3-title': 'Studio', 'tier3-price': '$14.99', 'tier3-li1': '100 Credits', 'tier3-li2': '24/7 Dedicated Support', 'tier3-li3': '4K Downloads',
                'prompt-modal-title': 'Wizard', 'prompt-modal-subtitle': 'What would you like to transform the selected area into?', 'prompt-placeholder': 'e.g., a red sports car', 'prompt-submit-btn': 'Transform',
                'payment-title': 'Secure Payment', 'card-number-label': 'Card Number', 'expiry-date-label': 'Expiry Date', 'cvc-label': 'CVC', 'card-name-label': 'Name on Card', 'btn-pay': 'Pay Now', 'payment-success': 'Payment successful! Credits have been added to your account.', 'payment-summary-prefix': 'You are purchasing the', 'payment-summary-suffix': 'plan.',
                'login-btn': 'Login', 'logout-btn': 'Logout', 'login-title': 'Login', 'email-label': 'Email', 'password-label': 'Password', 'login-btn-form': 'Login', 'no-account-text': "Don't have an account?", 'register-link': 'Sign Up', 'register-title': 'Sign Up', 'register-btn-form': 'Sign Up', 'have-account-text': 'Already have an account?', 'login-link': 'Login', 'unlimited-credits': 'Unlimited',
                'auth-error-weak-password': 'Password should be at least 6 characters.', 'auth-error-email-in-use': 'This email is already registered.', 'auth-error-invalid-email': 'Please enter a valid email address.', 'auth-error-generic': 'An error occurred. Please try again.', 'auth-error-wrong-password': 'Incorrect password or email.'
            },
            'tr': {
                'page-title': 'Retouch - Mükemmellik. Ortaya Çıktı.', 'brand-name': 'Retouch', 'nav-about': 'Hakkında', 'nav-pricing': 'Fiyatlandırma', 'nav-contact': 'İletişim', 
                'btn-start': 'Dönüşüme Başla', 'about-title': 'Hakkımızda', 'about-p': 'Retouch, fotoğraflarınızdaki istenmeyen nesneleri kusursuzca ortadan kaldırmak için en son yapay zeka teknolojisini kullanır. Misyonumuz, anılarınızı en saf haliyle korumanıza yardımcı olmaktır. Sadece birkaç tıklama ile dikkat dağıtıcı unsurları kaldırın ve mükemmel fotoğrafı ortaya çıkarın.', 'contact-title': 'İletişim', 'contact-p': 'Bize ulaşmak için contact@retouch.com adresine e-posta gönderebilirsiniz. Sorularınızı ve geri bildirimlerinizi bekliyoruz.', 'pricing-title': 'Size Uygun Planı Seçin', 'pricing-subtitle': 'Hemen başlayın ve yaratıcılığınızın sınırlarını kaldırın.', 'footer-text': '© 2024 Retouch |', 'footer-terms': 'Şartlar', 'footer-privacy': 'Gizlilik', 
                'tool-brush': 'Fırça Boyutu:', 'btn-erase': 'Sil (2 Kredi)', 'btn-transform': 'Dönüştür (3 Kredi)', 'btn-undo': 'Geri Al', 'btn-download': 'İndir', 'btn-back': 'Geri', 'loading-text': 'İşleniyor...', 
                'cookie-p': 'Sitemiz, kullanıcı deneyimini iyileştirmek için çerezleri kullanır. Bu siteyi kullanarak çerez kullanımımızı kabul etmiş olursunuz. Daha fazla bilgi için ', 'cookie-link': 'Gizlilik Politikamızı', 'cookie-btn': 'Kabul Et',
                'credit-label': 'Kredi:', 'modal-title': 'Krediniz Bitti!', 'modal-subtitle': 'Düzenlemeye devam etmek için bir paket seçin.',
                'tier1-title': 'Ücretsiz', 'tier1-price': 'Ücretsiz', 'tier1-li1': '5 Kredi', 'btn-free-start': 'Ücretsiz Başla',
                'popular-badge': 'Popüler', 'tier2-title': 'Profesyonel', 'tier2-price': '$9.99', 'tier2-li1': '50 Kredi', 'tier2-li2': 'HD İndirmeler', 'btn-purchase': 'Satın Al',
                'tier3-title': 'Stüdyo', 'tier3-price': '$14.99', 'tier3-li1': '100 Kredi', 'tier3-li2': '7/24 Özel Destek', 'tier3-li3': '4K İndirmeler',
                'prompt-modal-title': 'Sihirbaz', 'prompt-modal-subtitle': 'İşaretlediğiniz alanı neye dönüştürmek istersiniz?', 'prompt-placeholder': 'Örn: kırmızı bir spor araba', 'prompt-submit-btn': 'Dönüştür',
                'payment-title': 'Güvenli Ödeme', 'card-number-label': 'Kart Numarası', 'expiry-date-label': 'Son K. Tarihi', 'cvc-label': 'CVC', 'card-name-label': 'Kart Üzerindeki İsim', 'btn-pay': 'Ödeme Yap', 'payment-success': 'Ödeme başarılı! Krediler hesabınıza eklendi.', 'payment-summary-prefix': 'Satın almak üzere olduğunuz paket:', 'payment-summary-suffix': '',
                'login-btn': 'Giriş Yap', 'logout-btn': 'Çıkış Yap', 'login-title': 'Giriş Yap', 'email-label': 'E-posta', 'password-label': 'Şifre', 'login-btn-form': 'Giriş Yap', 'no-account-text': 'Hesabın yok mu?', 'register-link': 'Kayıt Ol', 'register-title': 'Kayıt Ol', 'register-btn-form': 'Kayıt Ol', 'have-account-text': 'Zaten hesabın var mı?', 'login-link': 'Giriş Yap', 'unlimited-credits': 'Sınırsız',
                'auth-error-weak-password': 'Şifre en az 6 karakter olmalıdır.', 'auth-error-email-in-use': 'Bu e-posta adresi zaten kayıtlı.', 'auth-error-invalid-email': 'Lütfen geçerli bir e-posta adresi girin.', 'auth-error-generic': 'Bir hata oluştu. Lütfen tekrar deneyin.', 'auth-error-wrong-password': 'E-posta veya şifre hatalı.'
            }
        };

        const slogans = {
            'en': [
                { title: 'Perfection. Unveiled.', subtitle: 'Remove the Unwanted. Reveal the Masterpiece.' },
                { title: 'Imagination. Realized.', subtitle: "Don't Just Erase, Reimagine." },
                { title: 'Flawless Frames. One Click Away.', subtitle: 'Transform Your Photos with AI.' },
                { title: 'Perfect Your Memories.', subtitle: 'Erase flaws, enhance moments.' },
                { title: 'Studio Quality. Your Control.', subtitle: 'Professional editing has never been this simple.' }
            ],
            'tr': [
                { title: 'Mükemmellik. Ortaya Çıktı.', subtitle: 'İstenmeyeni Kaldırın. Başyapıtı Ortaya Çıkarın.' },
                { title: 'Hayal Gücünüz. Gerçek Oldu.', subtitle: 'Sadece Silmeyin, Yeniden Yaratın.' },
                { title: 'Kusursuz Kareler. Tek Tıkla.', subtitle: 'Yapay Zeka ile Fotoğraflarınızı Dönüştürün.' },
                { title: 'Anılarınızı Mükemmelleştirin.', subtitle: 'Kusurları silin, anları parlatın.' },
                { title: 'Stüdyo Kalitesi Sizin Elinizde.', subtitle: 'Profesyonel düzenleme hiç bu kadar kolay olmamıştı.' }
            ]
        };

        function setCookie(n,v,d){let e="";if(d){const t=new Date;t.setTime(t.getTime()+d*24*60*60*1e3),e="; expires="+t.toUTCString()}document.cookie=n+"="+(v||"")+e+"; path=/"}
        function getCookie(n){const e=n+"=";const o=document.cookie.split(";");for(let t=0;t<o.length;t++){let i=o[t];for(;" "==i.charAt(0);)i=i.substring(1,i.length);if(0==i.indexOf(e))return i.substring(e.length,i.length)}return null}

        const setLanguage = (lang) => {
            document.documentElement.lang = lang;
            document.querySelectorAll('[data-lang]').forEach(el => {
                const key = el.getAttribute('data-lang');
                if (key === 'cookie-p') {
                    const link = `<a href="privacy.html" target="_blank" data-lang="cookie-link">${translations[lang]['cookie-link']}</a>`;
                    el.innerHTML = translations[lang][key] + link + '.';
                } else if(translations[lang][key]) {
                    el.textContent = translations[lang][key];
                }
            });
            document.querySelectorAll('[data-lang-placeholder]').forEach(el => {
                const key = el.getAttribute('data-lang-placeholder');
                if (translations[lang][key]) {
                    el.placeholder = translations[lang][key];
                }
            });
            document.title = translations[lang]['page-title'];
            document.querySelectorAll('.lang-option').forEach(opt => {
                opt.classList.remove('active');
                if (opt.getAttribute('data-lang-switch') === lang) opt.classList.add('active');
            });
            setCookie('language', lang, 365);
             if (currentUser && adminEmails.includes(currentUser.email)) {
                creditCountSpan.textContent = translations[lang]['unlimited-credits'];
            }
            startSloganCarousel();
        };
        
        document.querySelectorAll('.lang-option').forEach(opt => {
            opt.addEventListener('click', (e) => {
                e.preventDefault();
                setLanguage(opt.getAttribute('data-lang-switch'));
            });
        });

        // --- DOM ELEMENTLERİ ---
        const mainContent = document.getElementById('main-content');
        const editorScreen = document.getElementById('editor-screen');
        const uploadBtn = document.getElementById('upload-btn');
        const fileInput = document.getElementById('file-input');
        const canvas = document.getElementById('editor-canvas');
        const ctx = canvas.getContext('2d');
        const brushSizeSlider = document.getElementById('brush-size');
        const eraseBtn = document.getElementById('erase-btn');
        const transformBtn = document.getElementById('transform-btn');
        const undoBtn = document.getElementById('undo-btn');
        const backBtn = document.getElementById('back-btn');
        const downloadBtn = document.getElementById('download-btn');
        const loadingOverlay = document.getElementById('loading-overlay');
        const creditCountSpan = document.getElementById('credit-count');
        const loggedOutView = document.getElementById('logged-out-view');
        const loggedInView = document.getElementById('logged-in-view');
        const userEmailSpan = document.getElementById('user-email');
        const loginNavBtn = document.getElementById('login-nav-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const heroTitleEl = document.getElementById('hero-title');
        const heroSubtitleEl = document.getElementById('hero-subtitle');
        const pricingModal = document.getElementById('pricing-modal');
        const promptModal = document.getElementById('prompt-modal');
        const paymentModal = document.getElementById('payment-modal');
        const authModal = document.getElementById('auth-modal');
        const loginContainer = document.getElementById('login-container');
        const registerContainer = document.getElementById('register-container');
        const showRegisterBtn = document.getElementById('show-register-btn');
        const showLoginBtn = document.getElementById('show-login-btn');
        const authError = document.getElementById('auth-error');
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const paymentForm = document.getElementById('payment-form');
        const paymentSummary = document.getElementById('payment-summary');
        const promptInput = document.getElementById('prompt-input');
        const submitPromptBtn = document.getElementById('submit-prompt-btn');

        let originalImage = null, credits = 0, currentUser = null, selectedPlan = null, isAdmin = false, canvasHistory = [];

        // --- SLOGAN ANİMASYONU ---
        let sloganInterval, currentSloganIndex = 0;
        function changeSlogan() {
            const lang = getCookie('language') || 'tr';
            heroTitleEl.style.opacity = '0'; heroSubtitleEl.style.opacity = '0';
            setTimeout(() => {
                currentSloganIndex = (currentSloganIndex + 1) % slogans[lang].length;
                heroTitleEl.textContent = slogans[lang][currentSloganIndex].title;
                heroSubtitleEl.textContent = slogans[lang][currentSloganIndex].subtitle;
                heroTitleEl.style.opacity = '1'; heroSubtitleEl.style.opacity = '1';
            }, 500); 
        }
        function startSloganCarousel() {
            if (sloganInterval) clearInterval(sloganInterval);
            const lang = getCookie('language') || 'tr';
            currentSloganIndex = 0;
            heroTitleEl.textContent = slogans[lang][0].title;
            heroSubtitleEl.textContent = slogans[lang][0].subtitle;
            heroTitleEl.style.opacity = '1'; heroSubtitleEl.style.opacity = '1';
            sloganInterval = setInterval(changeSlogan, 10000);
        }

        // --- MODAL KONTROLLERİ ---
        function updateCreditDisplay() {
            const lang = getCookie('language') || 'tr';
            if (isAdmin) { creditCountSpan.textContent = translations[lang]['unlimited-credits']; } 
            else { creditCountSpan.textContent = credits; }
        }
        function showModal(modal) { modal.classList.add('show'); }
        function hideModal(modal) { modal.classList.remove('show'); }

        // --- KULLANICI İŞLEMLERİ (AUTH) ---
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUser = user;
                isAdmin = adminEmails.includes(user.email);
                const userDocRef = doc(db, "users", user.uid);
                const userDoc = await getDoc(userDocRef);
                
                if (isAdmin) {
                    credits = 99999;
                    if (!userDoc.exists() || userDoc.data().credits < 99999) {
                        await setDoc(userDocRef, { email: user.email, credits: 99999, role: 'admin' }, { merge: true });
                    }
                } else if (userDoc.exists()) {
                    credits = userDoc.data().credits;
                }
                
                updateCreditDisplay();
                userEmailSpan.textContent = user.email;
                loggedInView.style.display = 'flex';
                loggedOutView.style.display = 'none';
                hideModal(authModal);
            } else {
                currentUser = null; isAdmin = false; credits = 0;
                updateCreditDisplay();
                loggedInView.style.display = 'none';
                loggedOutView.style.display = 'block';
            }
        });
        loginNavBtn.addEventListener('click', () => showModal(authModal));
        logoutBtn.addEventListener('click', () => signOut(auth));
        showRegisterBtn.addEventListener('click', (e) => { e.preventDefault(); loginContainer.classList.remove('active'); registerContainer.classList.add('active'); authError.textContent = ''; });
        showLoginBtn.addEventListener('click', (e) => { e.preventDefault(); registerContainer.classList.remove('active'); loginContainer.classList.add('active'); authError.textContent = ''; });
        registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('register-email').value, password = document.getElementById('register-password').value, lang = getCookie('language') || 'tr';
            authError.textContent = '';
            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user, initialCredits = adminEmails.includes(user.email) ? 99999 : 5;
                const userData = { email: user.email, credits: initialCredits };
                if (adminEmails.includes(user.email)) userData.role = 'admin';
                await setDoc(doc(db, "users", user.uid), userData);
            } catch (error) {
                switch (error.code) {
                    case 'auth/weak-password': authError.textContent = translations[lang]['auth-error-weak-password']; break;
                    case 'auth/email-already-in-use': authError.textContent = translations[lang]['auth-error-email-in-use']; break;
                    case 'auth/invalid-email': authError.textContent = translations[lang]['auth-error-invalid-email']; break;
                    default: authError.textContent = translations[lang]['auth-error-generic'];
                }
            }
        });
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('login-email').value, password = document.getElementById('login-password').value, lang = getCookie('language') || 'tr';
            authError.textContent = '';
            try { await signInWithEmailAndPassword(auth, email, password); } 
            catch (error) { authError.textContent = translations[lang]['auth-error-wrong-password']; }
        });

        // --- ANA UYGULAMA MANTIĞI ---
        function updateUndoButton() { undoBtn.style.display = canvasHistory.length > 0 ? 'inline-block' : 'none'; }
        uploadBtn.addEventListener('click', (e) => { e.preventDefault(); fileInput.click(); });
        fileInput.addEventListener('change', (e) => { const file = e.target.files[0]; if (file) { const reader = new FileReader(); reader.onload = (event) => { const img = new Image(); img.onload = () => { originalImage = img; mainContent.style.display = 'none'; editorScreen.style.display = 'flex'; downloadBtn.style.display = 'none'; canvasHistory = []; updateUndoButton(); setupCanvas(img); }; img.src = event.target.result; }; reader.readAsDataURL(file); } });
        function setupCanvas(img) { const container = document.getElementById('canvas-container'), containerWidth = container.clientWidth, containerHeight = container.clientHeight; let canvasWidth = img.width, canvasHeight = img.height; const aspectRatio = img.width / img.height; if (canvasWidth > containerWidth) { canvasWidth = containerWidth; canvasHeight = canvasWidth / aspectRatio; } if (canvasHeight > containerHeight) { canvasHeight = containerHeight; canvasWidth = canvasHeight * aspectRatio; } canvas.width = canvasWidth; canvas.height = canvasHeight; ctx.drawImage(img, 0, 0, canvas.width, canvas.height); }
        let isDrawing = false, lastX = 0, lastY = 0;
        function getPos(canvas, evt, isTouch = false) { const rect = canvas.getBoundingClientRect(), scaleX = canvas.width / rect.width, scaleY = canvas.height / rect.height; const clientX = isTouch ? evt.touches[0].clientX : evt.clientX; const clientY = isTouch ? evt.touches[0].clientY : evt.clientY; return { x: (clientX - rect.left) * scaleX, y: (clientY - rect.top) * scaleY }; }
        function startDrawing(e) { isDrawing = true; const pos = getPos(canvas, e, e.type === 'touchstart'); [lastX, lastY] = [pos.x, pos.y]; }
        function draw(e) { if (!isDrawing) return; const pos = getPos(canvas, e, e.type === 'touchmove'); ctx.strokeStyle = 'rgba(255, 0, 80, 0.7)'; ctx.lineWidth = brushSizeSlider.value; ctx.lineCap = 'round'; ctx.lineJoin = 'round'; ctx.beginPath(); ctx.moveTo(lastX, lastY); ctx.lineTo(pos.x, pos.y); ctx.stroke(); [lastX, lastY] = [pos.x, pos.y]; }
        function stopDrawing() { isDrawing = false; }
        canvas.addEventListener('mousedown', startDrawing); canvas.addEventListener('mousemove', draw); canvas.addEventListener('mouseup', stopDrawing); canvas.addEventListener('mouseout', stopDrawing);
        canvas.addEventListener('touchstart', (e) => { e.preventDefault(); startDrawing(e); }, { passive: false }); canvas.addEventListener('touchmove', (e) => { e.preventDefault(); draw(e); }, { passive: false }); canvas.addEventListener('touchend', stopDrawing);
        backBtn.addEventListener('click', () => { editorScreen.style.display = 'none'; mainContent.style.display = 'block'; fileInput.value = ''; originalImage = null; canvasHistory = []; updateUndoButton(); });
        
        async function callGenerativeApi(userPrompt, creditCost, imageDataSource) {
            if (!currentUser) { showModal(authModal); return; }
            if (!isAdmin && credits < creditCost) { showModal(pricingModal); return; }
            
            const currentState = new Image();
            currentState.src = canvas.toDataURL('image/png');
            canvasHistory.push(currentState);
            updateUndoButton();

            loadingOverlay.style.display = 'flex';
            downloadBtn.style.display = 'none';

            try {
                const imageDataUrl = imageDataSource.toDataURL('image/png');
                const base64ImageData = imageDataUrl.split(',')[1];
                
                // BURASI ÇOK ÖNEMLİ!
                // Terminalden kopyaladığın kendi özel adresini buraya yapıştır.
                const functionUrl = "https://us-central1-retouch-f383d.cloudfunctions.net/generativeApiProxy";

                const response = await fetch(functionUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        prompt: userPrompt,
                        image: base64ImageData
                    })
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`API call failed: ${errorText}`);
                }

                const result = await response.json();
                const base64Data = result?.base64Data; 

                if (base64Data) {
                    const newImage = new Image();
                    newImage.onload = async () => {
                        originalImage = newImage;
                        setupCanvas(newImage);
                        downloadBtn.style.display = 'inline-block';
                        if (!isAdmin) {
                            const userDocRef = doc(db, "users", currentUser.uid);
                            await updateDoc(userDocRef, { credits: increment(-creditCost) });
                            credits -= creditCost;
                            updateCreditDisplay();
                        }
                    };
                    newImage.src = `data:image/png;base64,${base64Data}`;
                } else {
                    throw new Error('No image data received from the server.');
                }
            } catch (error) {
                console.error('Error processing image:', error);
                alert("İşlem sırasında bir hata oluştu. Lütfen daha sonra tekrar deneyin.");
                canvasHistory.pop(); // Hata durumunda son adımı geri al
                updateUndoButton();
            } finally {
                loadingOverlay.style.display = 'none';
            }
        }

        eraseBtn.addEventListener('click', () => {
            const lang = getCookie('language') || 'tr';
            const erasePrompt = lang === 'tr' ? "Fotoğrafın kırmızı ile işaretlenmiş alanlarını kaldır ve bu alanları, çevredeki dokuyla uyumlu olacak şekilde doğal bir biçimde doldur." : "Remove the areas marked in red from the photo and fill these areas naturally to match the surrounding texture.";
            callGenerativeApi(erasePrompt, 2, canvas);
        });
        transformBtn.addEventListener('click', () => {
             if (!currentUser) { showModal(authModal); return; }
             if (!isAdmin && credits < 3) { showModal(pricingModal); return; }
             showModal(promptModal);
        });
        submitPromptBtn.addEventListener('click', () => {
            const userPrompt = promptInput.value;
            if (userPrompt.trim() === '') return;
            hideModal(promptModal);
            callGenerativeApi(userPrompt, 3, canvas);
        });
        undoBtn.addEventListener('click', () => {
            if (canvasHistory.length > 0) {
                const lastState = canvasHistory.pop();
                originalImage = lastState;
                setupCanvas(lastState);
                updateUndoButton();
                downloadBtn.style.display = 'inline-block';
            }
        });
        downloadBtn.addEventListener('click', () => { const link = document.createElement('a'); link.download = 'retouch-edited.png'; link.href = originalImage.src; link.click(); });
        
        const cookieBanner = document.getElementById('cookie-consent-banner');
        const acceptCookiesBtn = document.getElementById('accept-cookies-btn');
        acceptCookiesBtn.addEventListener('click', () => { setCookie('cookie_consent', 'true', 365); cookieBanner.style.display = 'none'; });
        
        document.querySelectorAll('.close-modal-btn').forEach(btn => { btn.addEventListener('click', (e) => { e.target.closest('.modal-overlay').classList.remove('show'); }); });
        document.querySelectorAll('.modal-overlay').forEach(modal => { modal.addEventListener('click', (e) => { if (e.target === modal) { hideModal(modal); } }); });
        
        document.querySelectorAll('.btn-purchase').forEach(btn => {
            btn.addEventListener('click', (e) => {
                if (!currentUser) { showModal(authModal); return; }
                selectedPlan = e.target.dataset.plan;
                const lang = getCookie('language') || 'tr';
                const planName = selectedPlan === 'professional' ? translations[lang]['tier2-title'] : translations[lang]['tier3-title'];
                paymentSummary.textContent = `${translations[lang]['payment-summary-prefix']} ${planName} ${translations[lang]['payment-summary-suffix']}`;
                hideModal(pricingModal);
                showModal(paymentModal);
            });
        });
        paymentForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const lang = getCookie('language') || 'tr';
            alert(translations[lang]['payment-success']); // Bu kısım mock ödeme olduğu için alert ile bırakılmıştır.
            
            const creditsToAdd = selectedPlan === 'professional' ? 50 : 100;
            const userDocRef = doc(db, "users", currentUser.uid);
            await updateDoc(userDocRef, { credits: increment(creditsToAdd) });
            credits += creditsToAdd;
            updateCreditDisplay();
            hideModal(paymentModal);
        });
        window.addEventListener('load', () => {
             if (!getCookie('cookie_consent')) cookieBanner.style.display = 'flex';
             const savedLang = getCookie('language') || 'tr';
             setLanguage(savedLang);

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('is-visible');
                        observer.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.1 });
            document.querySelectorAll('#pricing .tier').forEach(tier => { observer.observe(tier); });
        });
    </script>
    <script>
        // Arka Plan Animasyonu
        const bgCanvas = document.getElementById('bg-canvas');
        const bgCtx = bgCanvas.getContext('2d');
        let width, height, particles;
        const PARTICLE_COUNT = 100, CONNECT_DISTANCE = 100, MOUSE_REPEL_DISTANCE = 150, PARTICLE_COLOR = '#FFD700';
        let mouse = { x: undefined, y: undefined };
        class Particle {
            constructor() {
                this.x = Math.random() * width; this.y = Math.random() * height;
                this.vx = (Math.random() - 0.5) * 0.5; this.vy = (Math.random() - 0.5) * 0.5;
                this.radius = 1.5;
            }
            update() {
                this.x += this.vx; this.y += this.vy;
                if (this.x < 0 || this.x > width) this.vx *= -1;
                if (this.y < 0 || this.y > height) this.vy *= -1;
            }
            draw() {
                bgCtx.beginPath(); bgCtx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                bgCtx.fillStyle = PARTICLE_COLOR; bgCtx.fill();
            }
        }
        function init() {
            width = bgCanvas.width = window.innerWidth; height = bgCanvas.height = window.innerHeight;
            particles = [];
            for (let i = 0; i < PARTICLE_COUNT; i++) particles.push(new Particle());
        }
        function connectParticles() {
             bgCtx.globalAlpha = 1;
            for (let i = 0; i < particles.length; i++) {
                for (let j = i; j < particles.length; j++) {
                    const dx = particles[i].x - particles[j].x, dy = particles[i].y - particles[j].y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    if (distance < CONNECT_DISTANCE) {
                        bgCtx.beginPath(); bgCtx.strokeStyle = PARTICLE_COLOR; bgCtx.lineWidth = 0.2;
                        bgCtx.globalAlpha = 1 - (distance / CONNECT_DISTANCE);
                        bgCtx.moveTo(particles[i].x, particles[i].y); bgCtx.lineTo(particles[j].x, particles[j].y);
                        bgCtx.stroke();
                    }
                }
            }
            if(mouse.x !== undefined && mouse.y !== undefined) {
                 for (let i = 0; i < particles.length; i++) {
                    const dx = particles[i].x - mouse.x, dy = particles[i].y - mouse.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    if (distance < MOUSE_REPEL_DISTANCE) {
                        bgCtx.beginPath(); bgCtx.strokeStyle = PARTICLE_COLOR; bgCtx.lineWidth = 0.5;
                        bgCtx.globalAlpha = 1 - (distance / MOUSE_REPEL_DISTANCE);
                        bgCtx.moveTo(particles[i].x, particles[i].y); bgCtx.lineTo(mouse.x, mouse.y);
                        bgCtx.stroke();
                    }
                }
            }
            bgCtx.globalAlpha = 1;
        }
        function animate() {
            bgCtx.clearRect(0, 0, width, height);
            particles.forEach(p => { p.update(); p.draw(); });
            connectParticles();
            requestAnimationFrame(animate);
        }
        window.addEventListener('resize', init);
        bgCanvas.addEventListener('mousemove', e => { mouse.x = e.clientX; mouse.y = e.clientY; });
        bgCanvas.addEventListener('mouseleave', () => { mouse.x = undefined; mouse.y = undefined; });
        init(); animate();
    </script>
</body>
</html>

